<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spark for Social Science</title>
  <meta name="description" content="Spark for Social Science">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Spark for Social Science" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="urbaninstitute/spark-social-science-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spark for Social Science" />
  
  
  

<meta name="author" content="Research Programming, The Urban Institute">


<meta name="date" content="2017-01-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="understanding-spark.html">
<link rel="next" href="data-visualization.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spark Social Science Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About Spark Social Science</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> - Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#outgrowing-the-server-when-should-social-scientists-consider-distributed-computing"><i class="fa fa-check"></i><b>1.1</b> Outgrowing the server: When should social scientists consider distributed computing?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#making-distributed-computing-straightforward-cost-effective"><i class="fa fa-check"></i><b>1.2</b> Making distributed computing straightforward &amp; cost-effective</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-with-spark.html"><a href="getting-started-with-spark.html"><i class="fa fa-check"></i><b>2</b> - Getting Started with Spark</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started-with-spark.html"><a href="getting-started-with-spark.html#what-about-stata-and-sas"><i class="fa fa-check"></i><b>2.1</b> What About Stata and SAS?</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-with-spark.html"><a href="getting-started-with-spark.html#choosing-between-sparkr-and-pyspark"><i class="fa fa-check"></i><b>2.2</b> Choosing Between SparkR and PySpark</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="understanding-spark.html"><a href="understanding-spark.html"><i class="fa fa-check"></i><b>3</b> - Understanding Spark</a><ul>
<li class="chapter" data-level="3.1" data-path="understanding-spark.html"><a href="understanding-spark.html#what-is-apache-spark"><i class="fa fa-check"></i><b>3.1</b> What is Apache Spark?</a></li>
<li class="chapter" data-level="3.2" data-path="understanding-spark.html"><a href="understanding-spark.html#what-makes-cluster-computing-different"><i class="fa fa-check"></i><b>3.2</b> What Makes Cluster Computing Different?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sorting-distributed-data.html"><a href="sorting-distributed-data.html"><i class="fa fa-check"></i><b>4</b> - Sorting Distributed Data</a><ul>
<li class="chapter" data-level="4.1" data-path="sorting-distributed-data.html"><a href="sorting-distributed-data.html#sorting-in-distributed-computing"><i class="fa fa-check"></i><b>4.1</b> Sorting in Distributed Computing</a></li>
<li class="chapter" data-level="4.2" data-path="sorting-distributed-data.html"><a href="sorting-distributed-data.html#shuffling-intuition"><i class="fa fa-check"></i><b>4.2</b> Shuffling Intuition</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>5</b> - Data Visualization</a><ul>
<li class="chapter" data-level="5.1" data-path="data-visualization.html"><a href="data-visualization.html#visualization-process"><i class="fa fa-check"></i><b>5.1</b> Visualization Process</a></li>
<li class="chapter" data-level="5.2" data-path="data-visualization.html"><a href="data-visualization.html#section"><i class="fa fa-check"></i><b>5.2</b> </a></li>
<li class="chapter" data-level="5.3" data-path="data-visualization.html"><a href="data-visualization.html#recommended-charts"><i class="fa fa-check"></i><b>5.3</b> Recommended Charts</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="econometrics-and-large-scale-data.html"><a href="econometrics-and-large-scale-data.html"><i class="fa fa-check"></i><b>6</b> - Econometrics and Large-scale Data</a><ul>
<li class="chapter" data-level="6.1" data-path="econometrics-and-large-scale-data.html"><a href="econometrics-and-large-scale-data.html#implications-for-hypothesis-testing"><i class="fa fa-check"></i><b>6.1</b> Implications for Hypothesis Testing</a><ul>
<li class="chapter" data-level="6.1.1" data-path="econometrics-and-large-scale-data.html"><a href="econometrics-and-large-scale-data.html#statistical-v.-practical-significance"><i class="fa fa-check"></i><b>6.1.1</b> Statistical v. Practical Significance</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="econometrics-and-large-scale-data.html"><a href="econometrics-and-large-scale-data.html#mathematical-and-computational-implications"><i class="fa fa-check"></i><b>6.2</b> Mathematical and Computational Implications</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advanced-spark.html"><a href="advanced-spark.html"><i class="fa fa-check"></i><b>7</b> - Advanced Spark</a><ul>
<li class="chapter" data-level="7.1" data-path="advanced-spark.html"><a href="advanced-spark.html#spark-sql"><i class="fa fa-check"></i><b>7.1</b> Spark SQL</a></li>
<li class="chapter" data-level="7.2" data-path="advanced-spark.html"><a href="advanced-spark.html#spark-streaming"><i class="fa fa-check"></i><b>7.2</b> Spark Streaming</a></li>
<li class="chapter" data-level="7.3" data-path="advanced-spark.html"><a href="advanced-spark.html#graphx"><i class="fa fa-check"></i><b>7.3</b> GraphX</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>8</b> - Appendix</a><ul>
<li class="chapter" data-level="8.1" data-path="appendix.html"><a href="appendix.html#unbounded-sample-size-statistical-significance-sketch-of-proof"><i class="fa fa-check"></i><b>8.1</b> Unbounded sample size &amp; statistical significance – sketch of proof</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="glossary-of-terms.html"><a href="glossary-of-terms.html"><i class="fa fa-check"></i><b>9</b> - Glossary of Terms</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spark for Social Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sorting-distributed-data" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> - Sorting Distributed Data</h1>
<div id="sorting-in-distributed-computing" class="section level2">
<h2><span class="header-section-number">4.1</span> Sorting in Distributed Computing</h2>
<p>When working with datasets of sizes traditionally seen in social science research, sorting the data by some variable is an easy task. Since all of the data is in the memory of one computer, all of the shuffling can be done quickly and efficiently.</p>
<p>However, when working with massive data in a distributed environment, in which many millions of observations may be distributed across hundreds of machines, sorting data becomes an enormously expensive operation. Intuitively, this is because your data is <strong>partitioned</strong>. This means that the rows of data are spread in groups across all the different machines in your cluster. In order to perform the sort, Spark must execute a <strong>shuffle</strong> operation, which repartitions the data, moving much of it between the machines of the cluster.</p>
<p>Notably, sorts (and therefore shuffles) occur far more often than you might realize, given that they are essential part of other common operations. For instance, sorting occurs during:</p>
<ul>
<li>Merging (<a href="https://github.com/UrbanInstitute/sparkr-tutorials/blob/master/merging.md#merging-sparkr-dataframes">SparkR</a> &amp; <a href="https://github.com/UrbanInstitute/pyspark-tutorials/blob/master/merging.ipynb">PySpark</a>)</li>
<li>Grouped Aggregations (<a href="https://github.com/UrbanInstitute/sparkr-tutorials/blob/master/summary-statistics.md#categorical-data">SparkR</a> &amp; <a href="https://github.com/UrbanInstitute/pyspark-tutorials/blob/master/basics%202.ipynb">PySpark</a></li>
<li>Calculating Quantiles (<a href="https://github.com/UrbanInstitute/sparkr-tutorials/blob/master/summary-statistics.md#approximate-quantiles">SparkR</a>)</li>
</ul>
</div>
<div id="shuffling-intuition" class="section level2">
<h2><span class="header-section-number">4.2</span> Shuffling Intuition</h2>
<p>Spark needs to first consider your sorting criteria (e.g. dates, alphabetical, numerical, ascending, descending), then search through all of the systems in the cluster to figure out what and where the first and last values are, what the intervals are between values and whether there are duplicates or not. From there it has to estimate where all of the data should go and where to shift the values of which this data will take the spot.</p>
<p>Each observation takes up space in memory, and since we’ve spread our data out across many nodes due to its size, Spark cannot simply hold every piece of data in its current location until it has the correct place for it. The data, therefore, becomes more spread out when information is “shuffled” since Spark holds observations elsewhere until it determines where they should be placed. Imagine, for example, six computers holding twelve observations, one for each month. If no machine can hold more than two observations, and January and November are on one machine, Spark might go find February and decide it needs to be next to January. However, in order to move it there it needs to first put November somewhere temporarily.</p>
<p>Every time something is moved between machines, it involves both recalculating partitions and movement over the computer network, which is much slower than moving data within one machine. Additionally, data may be forced onto the hard drives of the nodes if there is not enough extra memory space. Hard drive traffic is much slower than even network traffic.</p>
<p>Any operation that causes a shuffling of data, or a “shuffle,” can be very costly in terms of processing power, hard drive traffic and system memory. And since Spark clusters on AWS are paid for by the second of usage, excessive shuffling can be costly in dollars also. Researchers should understand that several tasks that can be performed in Spark require a shuffle, and that this shuffling may be obscured. Spark operations that do require a shuffle include, for example, joining datasets on equal values of some specified column and finding unique values of a column. Some shuffling is often inevitable; just note that shuffles will be one of the largest drivers of how long your operations take to finish.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="understanding-spark.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-sorting.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
